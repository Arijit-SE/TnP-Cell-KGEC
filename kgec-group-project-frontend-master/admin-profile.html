<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>My Profile | KGEC TnP Cell</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
    integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
  <style>
    main {
      margin-left: 25vw;
      width: 75vw;
      overflow: hidden;
    }

    #open-nav-container {
      position: fixed;
      top: 0px;
      width: 100%;
      z-index: 1;
      background-color: white;
      box-shadow: 0px 0px 8px 8px rgba(0, 0, 0, 0.1);
    }

    nav {
      border-top-right-radius: 10px;
      border-bottom-right-radius: 10px;
      transition: 0.25s ease-in-out;
      background-color: white;
      z-index: 2;
    }

    #stream-select,
    #specialization-select,
    #yop-form,
    #current-percentage-form,
    #graduation-percentage-form,
    #higher-secondary-percentage-form,
    #secondary-percentage-form,
    #active-backlog-form,
    #year-gap-form {
      display: none;
    }

    @media screen and (max-width: 768px) {
      nav {
        border-radius: 0px;
        position: absolute;
      }

      .hidden-nav {
        translate: -100% 0px;
      }

      main {
        margin: 0px;
        width: 100vw;
      }
    }

    @media screen and (min-width: 1080px) {
      body {
        background-color: rgb(249, 250, 252);
      }

      #container {
        margin-top: 3rem;
        display: flex;
        justify-content: space-evenly;

      }

      #container>div {
        border-radius: 10px;
        padding: 2rem;
        box-shadow: 0px 0px 8px 8px rgba(0, 0, 0, 0.1);
      }

      #container h3 {
        text-align: center;
      }
    }
  </style>
</head>

<body>
  <nav class="w-25 hidden-nav" style="height: 100%; position: fixed; top: 0px; overflow: hidden; ">
    <ul class="list-group rounded-0">
      <a class="list-group-item active" href="#">My Profile</a>
      <!-- <a class="list-group-item" href="verify-admin.html">Verify Admins</a> -->
      <a class="list-group-item" href="verify-company.html">Verify Companies</a>
      <a class="list-group-item" href="verify-job.html">Verify Job</a>
      <a class="list-group-item" href="admin-applied-students.html">Applied Students</a>
      <a class="list-group-item" href="admin-signin.html">Logout</a>
      <button id="close-nav" class="btn" style="border: none;"><i class="fa fa-2x fa-close"></i></button>
    </ul>
  </nav>
  <div id="open-nav-container">
    <button id="open-nav" class="btn" style="border: none;"><i class="fa fa-2x fa-bars"></i></button>
  </div>
  <main class="p-2">
    <h1 style=" text-align: center;">My Profile</h1>
    <div id="container">
      <div style="height: min-content; background-color: white; flex: 1; max-width: 30rem;">
        <h3>Basic Details</h3>
        <div style="margin-left: 1rem;">
          <div style="display: flex; align-items: center;">
            <h6>Name</h6>
            <button class="btn" style="border: none;" id="edit-name"><i class="fa fa-pen"></i></button>
          </div>
          <p id="name"></p>
          <form id="name-form" style="display: none;">
            <input type="text" class="form-control" style="margin-bottom: 0.5rem;" id="new-name" required>
            <input type="submit" class="btn btn-primary">
          </form>
          <div style="display: flex; align-items: center;">
            <h6>Date of Birth</h6>
            <button class="btn" style="border: none;" id="edit-dob"><i class="fa fa-pen"></i></button>
          </div>
          <p id="dob"></p>
          <form id="dob-form" style="display: none;">
            <input type="date" class="form-control" style="margin-bottom: 0.5rem;" id="new-dob" required>
            <input type="submit" class="btn btn-primary">
          </form>
          <div style="display: flex; align-items: center;">
            <h6>Gender</h6>
            <button class="btn" style="border: none;" id="edit-gender"><i class="fa fa-pen"></i></button>
          </div>
          <p id="gender"></p>
          <select class="form-select" style="display: none;" id="gender-select" onfocus="this.selectedIndex = -1;">
            <option value="" disabled selected>Select your gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
          </select>
          <div style="display: flex; align-items: center;">
            <h6>Address</h6>
            <button class="btn" style="border: none;" id="edit-address"><i class="fa fa-pen"></i></button>
          </div>
          <p id="address"></p>
          <form id="address-form" style="display: none;">
            <input type="text" class="form-control" style="margin-bottom: 0.5rem;" id="new-address" required>
            <input type="submit" class="btn btn-primary">
          </form>
          <div style="display: flex; align-items: center;">
            <h6>Email</h6>
            <button class="btn" style="border: none;" id="edit-email"><i class="fa fa-pen"></i></button>
          </div>
          <p id="email"></p>
          <form id="email-form" style="display: none;">
            <input type="email" class="form-control" style="margin-bottom: 0.5rem;" id="new-email" required>
            <input type="submit" class="btn btn-primary">
          </form>
          <div style="display: flex; align-items: center;">
            <h6>Phone</h6>
            <button class="btn" style="border: none;" id="edit-phone"><i class="fa fa-pen"></i></button>
          </div>
          <p id="phone"></p>
          <form id="phone-form" style="display: none;">
            <input type="tel" class="form-control" style="margin-bottom: 0.5rem;" id="new-phone" required>
            <input type="submit" class="btn btn-primary">
          </form>
        </div>
      </div>
    </div>
  </main>
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
<script>
  document.addEventListener("wheel", function (event) {
    if (document.activeElement.type === "number") {
      document.activeElement.blur();
    }
  });

  window.addEventListener('resize', displayProperly);

  const openNav = document.getElementById('open-nav');
  openNav.addEventListener('click', function () {
    document.getElementsByTagName('nav')[0].classList.remove('hidden-nav');
  })

  const closeNav = document.getElementById('close-nav');
  closeNav.addEventListener('click', function () {
    document.getElementsByTagName('nav')[0].classList.add('hidden-nav');
  })

  let student = null;
  async function fetchStudent() {
    try {
      const response = await fetch('http://localhost:8080/admin/', {
        credentials: 'include'
      });
      if (response.status === 200) {
        student = await response.json();
        document.getElementById('name').innerHTML = student.name;
        let date = '';
        date = date + student.dateOfBirth.slice(8, 10);
        date = date + '/'
        date = date + student.dateOfBirth.slice(5, 7);
        date = date + '/'
        date = date + student.dateOfBirth.slice(0, 4);
        document.getElementById('dob').innerHTML = date;
        document.getElementById('gender').innerHTML = student.gender;
        document.getElementById('address').innerHTML = student.address;
        document.getElementById('email').innerHTML = student.email;
        document.getElementById('phone').innerHTML = student.phone;
      } else if (response.status === 401) {
        location.href = 'admin-singin.html';
      } else {
        location.href = 'admin-singin.html';
      }
    } catch (error) {
      location.href = 'admin-singin.html';
    }
  }

  function displayProperly() {
    if (window.innerWidth <= 768) {
      // openNav.style.display = 'block';
      closeNav.style.display = 'block';
      document.getElementById('open-nav-container').style.display = 'block';
      document.getElementsByTagName('main')[0].style.marginTop = '3rem';
      document.getElementsByTagName('nav')[0].classList.remove('w-25');
      document.getElementsByTagName('nav')[0].classList.remove('shadow');
      document.getElementsByTagName('nav')[0].classList.add('w-100');
      document.getElementsByTagName('nav')[0].classList.add('hidden-nav');
    } else {
      // openNav.style.display = 'none';
      closeNav.style.display = 'none';
      document.getElementById('open-nav-container').style.display = 'none';
      document.getElementsByTagName('main')[0].style.marginTop = '0rem';
      document.getElementsByTagName('nav')[0].classList.add('w-25');
      document.getElementsByTagName('nav')[0].classList.add('shadow');
      document.getElementsByTagName('nav')[0].classList.remove('w-100');
      document.getElementsByTagName('nav')[0].classList.remove('hidden-nav');
    }
  }

  const editNameButton = document.getElementById('edit-name');
  const name = document.getElementById('name');
  const nameForm = document.getElementById('name-form');
  editNameButton.addEventListener('click', function () {
    editNameButton.setAttribute('disabled', '');
    name.style.display = 'none';
    nameForm.style.display = 'block';
  });
  nameForm.addEventListener('submit', async function (event) {
    event.preventDefault();
    try {
      const response = await fetch('http://localhost:8080/admin/name', {
        method: 'PUT',
        credentials: 'include',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          'name': document.getElementById('new-name').value
        })
      });
      if (response.status === 200) {
        try {
          const response = await fetch('http://localhost:8080/admin/name', {
            credentials: 'include',
          });
          if (response.status === 200) {
            editNameButton.removeAttribute('disabled');
            nameForm.style.display = 'none';
            name.innerHTML = await response.text();
            name.style.display = 'block';
          } else {
            alert('Some error has occured');
          }
        } catch (error) {
          alert('I guess, there is no internet connection');
        }
      } else {
        alert('Some error has occured');
      }
    } catch (error) {
      alert('I guess, there is no internet connection');
    }
  });

  const editDOBButton = document.getElementById('edit-dob');
  const dob = document.getElementById('dob');
  const dobForm = document.getElementById('dob-form');
  editDOBButton.addEventListener('click', function () {
    editDOBButton.setAttribute('disabled', '');
    dob.style.display = 'none';
    dobForm.style.display = 'block';
  });
  dobForm.addEventListener('submit', async function (event) {
    event.preventDefault();
    try {
      const response = await fetch('http://localhost:8080/admin/dob', {
        method: 'PUT',
        credentials: 'include',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          'dob': document.getElementById('new-dob').value
        })
      });
      if (response.status === 200) {
        try {
          const response = await fetch('http://localhost:8080/admin/dob', {
            credentials: 'include',
          });
          if (response.status === 200) {
            editDOBButton.removeAttribute('disabled');
            dobForm.style.display = 'none';
            let date = '';
            let body = new Date(await response.text()).toISOString();
            date = date + body.slice(8, 10);
            date = date + '/'
            date = date + body.slice(5, 7);
            date = date + '/'
            date = date + body.slice(0, 4);
            document.getElementById('dob').innerHTML = date;
            dob.style.display = 'block';
          } else {
            alert('Some error has occured');
          }
        } catch (error) {
          alert('I guess, there is no internet connection');
        }
      } else {
        alert('Some error has occured');
      }
    } catch (error) {
      alert('I guess, there is no internet connection');
    }
  });

  const editGenderButton = document.getElementById('edit-gender');
  const gender = document.getElementById('gender');
  const genderSelect = document.getElementById('gender-select');
  editGenderButton.addEventListener('click', function () {
    editGenderButton.setAttribute('disabled', '');
    gender.style.display = 'none';
    genderSelect.style.display = 'block';
  });
  genderSelect.addEventListener('change', async function () {
    try {
      const response = await fetch('http://localhost:8080/admin/gender', {
        method: 'PUT',
        credentials: 'include',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          'gender': genderSelect.value
        })
      });
      if (response.status === 200) {
        try {
          const response = await fetch('http://localhost:8080/admin/gender', {
            credentials: 'include',
          });
          if (response.status === 200) {
            editGenderButton.removeAttribute('disabled');
            genderSelect.style.display = 'none';
            gender.innerHTML = await response.text();
            gender.style.display = 'block';
          } else {
            alert('Some error has occured');
          }
        } catch (error) {
          alert('I guess, there is no internet connection');
        }
      } else {
        alert('Some error has occured');
      }
    } catch (error) {
      alert('I guess, there is no internet connection');
    }
  });


  const editAddressButton = document.getElementById('edit-address');
  const address = document.getElementById('address');
  const addressForm = document.getElementById('address-form');
  editAddressButton.addEventListener('click', function () {
    editAddressButton.setAttribute('disabled', '');
    address.style.display = 'none';
    addressForm.style.display = 'block';
  });
  addressForm.addEventListener('submit', async function (event) {
    event.preventDefault();
    try {
      const response = await fetch('http://localhost:8080/admin/address', {
        method: 'PUT',
        credentials: 'include',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          'address': document.getElementById('new-address').value
        })
      });
      if (response.status === 200) {
        try {
          const response = await fetch('http://localhost:8080/admin/address', {
            credentials: 'include',
          });
          if (response.status === 200) {
            editAddressButton.removeAttribute('disabled');
            addressForm.style.display = 'none';
            address.innerHTML = await response.text();
            address.style.display = 'block';
          } else {
            alert('Some error has occured');
          }
        } catch (error) {
          alert('I guess, there is no internet connection');
        }
      } else {
        alert('Some error has occured');
      }
    } catch (error) {
      alert('I guess, there is no internet connection');
    }
  });

  const editEmailButton = document.getElementById('edit-email');
  const email = document.getElementById('email');
  const emailForm = document.getElementById('email-form');
  editEmailButton.addEventListener('click', function () {
    editEmailButton.setAttribute('disabled', '');
    email.style.display = 'none';
    emailForm.style.display = 'block';
  });
  emailForm.addEventListener('submit', async function (event) {
    event.preventDefault();
    try {
      const response = await fetch('http://localhost:8080/admin/email', {
        method: 'PUT',
        credentials: 'include',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          'email': document.getElementById('new-email').value
        })
      });
      if (response.status === 200) {
        try {
          const response = await fetch('http://localhost:8080/admin/email', {
            credentials: 'include',
          });
          if (response.status === 200) {
            editEmailButton.removeAttribute('disabled');
            emailForm.style.display = 'none';
            email.innerHTML = await response.text();
            email.style.display = 'block';
          } else {
            alert('Some error has occured');
          }
        } catch (error) {
          alert('I guess, there is no internet connection');
        }
      } else {
        alert('Some error has occured');
      }
    } catch (error) {
      alert('I guess, there is no internet connection');
    }
  });

  const editPhoneButton = document.getElementById('edit-phone');
  const phone = document.getElementById('phone');
  const phoneForm = document.getElementById('phone-form');
  editPhoneButton.addEventListener('click', function () {
    editPhoneButton.setAttribute('disabled', '');
    phone.style.display = 'none';
    phoneForm.style.display = 'block';
  });
  phoneForm.addEventListener('submit', async function (event) {
    event.preventDefault();
    try {
      const response = await fetch('http://localhost:8080/admin/phone', {
        method: 'PUT',
        credentials: 'include',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          'phone': document.getElementById('new-phone').value
        })
      });
      if (response.status === 200) {
        try {
          const response = await fetch('http://localhost:8080/admin/phone', {
            credentials: 'include',
          });
          if (response.status === 200) {
            editPhoneButton.removeAttribute('disabled');
            phoneForm.style.display = 'none';
            phone.innerHTML = await response.text();
            phone.style.display = 'block';
          } else {
            alert('Some error has occured');
          }
        } catch (error) {
          alert('I guess, there is no internet connection');
        }
      } else {
        alert('Some error has occured');
      }
    } catch (error) {
      alert('I guess, there is no internet connection');
    }
  });

  window.onload = function () {
    displayProperly();
    fetchStudent();
  };
</script>

</html>